<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Résolution du Problème du Voyageur de Commerce avec GoJS</title>
        <script src="release/go-debug.js"></script>
        <style>
            #myDiagramDiv {
                width: 1000px;
                height: 1000px;
            }
        </style>
    </head>
    <body>
        <div id="myDiagramDiv"></div>
        <script>
            // Données des villes et distances
            var cities = [
                { key: "A", x: 50, y: 100, distance: 20 },
                { key: "C", x: 150, y: 100, distance: 30 },
                { key: "E", x: 250, y: 100, distance: 40 },
                { key: "B", x: 350, y: 100, distance: 45 },
                { key: "D", x: 450, y: 100, distance: 55 },
            ];

            // Solution optimale (ordre de visite des villes)
            var optimalSolution = ["A", "C", "E", "B", "D"];

            // Initialisation du diagramme
            var $ = go.GraphObject.make;

            var myDiagram = $(go.Diagram, "myDiagramDiv", {
                "undoManager.isEnabled": true,
                layout: $(go.CircularLayout),
            });

            // Ajout des villes
            myDiagram.nodeTemplate = $(
                go.Node,
                "Auto",
                { locationSpot: go.Spot.Center },
                new go.Binding("location", "", function (data) {
                    return new go.Point(data.x, data.y);
                }),
                $(go.Shape, "Circle", { fill: "lightblue", stroke: null }),
                $(
                    go.Panel,
                    "Vertical",
                    $(
                        go.TextBlock,
                        { margin: 8 },
                        new go.Binding("text", "key")
                    ),
                    $(
                        go.TextBlock,
                        { margin: 8 },
                        new go.Binding("text", "distance", function (distance) {
                            return "Distance: " + distance.toString();
                        })
                    )
                )
            );

            // Création des villes
            myDiagram.model = new go.GraphLinksModel(cities);

            // Création du cercle continu
            var routeDataArray = [];
            for (var i = 0; i < optimalSolution.length; i++) {
                var city = cities.find(function (city) {
                    return city.key === optimalSolution[i];
                });
                routeDataArray.push({ key: city.key, x: city.x, y: city.y });
            }

            // Ajout des arcs
            myDiagram.linkTemplate = $(
                go.Link,
  { routing: go.Link.AvoidsNodes },
  $(go.Shape, { stroke: "black" }),
  $(
    go.TextBlock,
    {
      segmentIndex: -1, // Positionne le texte au milieu du chemin de la flèche
      font: "10pt sans-serif",
      stroke: "black",
      alignmentFocus: go.Spot.Bottom, // Aligne le texte en bas de la position du segment
      segmentOrientation: go.Link.OrientUpright, // Oriente le texte verticalement
     segmentOffset: new go.Point(0, -10), // Décalage vertical pour le positionnement
    },
    new go.Binding("text", "", function (data) {
      var fromCity = cities.find(function (city) {
        return city.key === data.from;
      });
      var toCity = cities.find(function (city) {
        return city.key === data.to;
      });
      
      return "Distance: " + distance.toFixed(2).toString();
    })
  )
            );

            // Création des liens
            for (var i = 0; i < routeDataArray.length - 1; i++) {
                var from = routeDataArray[i].key;
                var to = routeDataArray[i + 1].key;
                myDiagram.model.addLinkData({ from: from, to: to });
            }

            // Lien de retour à la ville A
            myDiagram.model.addLinkData({
                from: optimalSolution[optimalSolution.length - 1],
                to: optimalSolution[0],
            });
        </script>
    </body>
</html>
